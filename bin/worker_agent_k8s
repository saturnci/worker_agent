#!/usr/bin/env ruby
# frozen_string_literal: true

# K8s entry point - hello world version

require 'base64'
require_relative '../lib/saturn_ci_worker_api/request'

host = ENV.fetch('SATURNCI_API_HOST')
task_id = ENV.fetch('TASK_ID')

puts 'Sending hello world to system logs...'
body = Base64.encode64('Hello from K8s worker!')
SaturnCIWorkerAPI::Request.new(
  host: host,
  method: :post,
  endpoint: "tasks/#{task_id}/system_logs",
  body: body,
  content_type: 'text/plain'
).execute

puts 'Done'
